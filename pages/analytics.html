<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - Academic Assistant</title>
    <link rel="stylesheet" href="/public/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-graduation-cap"></i>
                <span>EduTrack</span>
            </div>
            <ul class="nav-menu" id="nav-menu">
                <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                <li class="nav-item"><a href="/dashboard" class="nav-link">Dashboard</a></li>
                <li class="nav-item"><a href="/scores" class="nav-link">Scores</a></li>
                <li class="nav-item"><a href="analytics.html" class="nav-link active">Analytics</a></li>
                <li class="nav-item"><a href="goals.html" class="nav-link">Goals</a></li>
                <li class="nav-item"><a href="reports.html" class="nav-link">Reports</a></li>
                <li class="nav-item"><a href="about.html" class="nav-link">About</a></li>
                <li class="nav-item"><a href="/login" class="nav-link">Login</a></li>
            </ul>
            <div class="hamburger" id="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1>Performance Analytics</h1>
            <p>Deep insights into your academic performance with advanced analytics</p>
        </div>
         <div class="hero-image">
                <div class="hero-graphic">
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>
    </section>

    <!-- Analytics Content -->
    <section class="analytics-content">
        <div class="container">
            <!-- Analytics Grid -->
            <div class="analytics-grid">
                <!-- Performance Overview Chart -->
                <div class="analytics-card large-card">
                    <div class="card-header">
                        <h3>Performance Trend Analysis</h3>
                    </div>
                    <div class="card-content">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <!-- Study Hours vs Assignments -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3>Study Hours vs Assignments</h3>
                    </div>
                    <div class="card-content">
                        <canvas id="subjectChart"></canvas>
                    </div>
                </div>

                <!-- Attendance Chart -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3>Attendance Percentage</h3>
                    </div>
                    <div class="card-content">
                        <canvas id="attendanceChart"></canvas>
                    </div>
                </div>

                <!-- Subject Weakness Pie Chart -->
                <!-- <div class="analytics-card">
                    <div class="card-header">
                        <h3>Weak Subjects</h3>
                    </div>
                    <div class="card-content">
                        <canvas id="weakSubjectsChart"></canvas>
                        <p id="weakSubjectsList" style="margin-top:10px; font-weight:bold; color:red;"></p>
                    </div>
                </div> -->

            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Academic Assistant</span>
                    </div>
                    <p>Empowering students to achieve academic excellence through data-driven insights and personalized guidance.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="dashboard.html">Dashboard</a></li>
                        <li><a href="scores.html">Scores</a></li>
                        <li><a href="analytics.html">Analytics</a></li>
                        <li><a href="goals.html">Goals</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Connect With Us</h4>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 EduTrack. All rights reserved.</p>
            </div>
        </div>
    </footer>

   <script>
    const progressData = JSON.parse(localStorage.getItem('progressData')) || [];
    const weeks = progressData.map(d => `Week ${d.week}`);

    // Existing charts
    new Chart(document.getElementById('trendChart'), {
        type: 'line',
        data: {
            labels: weeks,
            datasets: [{
                label: 'Study Hours',
                data: progressData.map(d => d.studyHours),
                borderColor: 'blue',
                fill: false
            }]
        }
    });

    new Chart(document.getElementById('subjectChart'), {
        type: 'bar',
        data: {
            labels: weeks,
            datasets: [
                {
                    label: 'Study Hours',
                    data: progressData.map(d => d.studyHours),
                    backgroundColor: 'rgba(75, 192, 192, 0.6)'
                },
                {
                    label: 'Assignments Completed',
                    data: progressData.map(d => d.assignmentsCompleted),
                    backgroundColor: 'rgba(153, 102, 255, 0.6)'
                }
            ]
        }
    });

    new Chart(document.getElementById('attendanceChart'), {
        type: 'bar',
        data: {
            labels: weeks,
            datasets: [{
                label: 'Attendance %',
                data: progressData.map(d => d.attendancePercentage),
                backgroundColor: 'rgba(255, 159, 64, 0.6)'
            }]
        },
        options: {
            scales: { y: { beginAtZero: true, max: 100 } }
        }
    });

    // ================= Weak Subjects Pie Chart =================
  
(async function(){
    try {
        const res = await fetch('/api/scores');
        if (!res.ok) throw new Error("Failed to fetch scores");
        const data = await res.json();

        // Expecting { scores: [{ subject, score, max_score }] }
        const subjectScores = {};
        data.scores.forEach(s => {
            const percent = (s.score / s.max_score) * 100;
            if (!subjectScores[s.subject]) subjectScores[s.subject] = [];
            subjectScores[s.subject].push(percent);
        });

        const labels = [];
        const avgScores = [];
        const weakSubjects = [];

        const colorPalette = [
            '#FF6384', '#36A2EB', '#FFCE56',
            '#4BC0C0', '#9966FF', '#FF9F40', '#FFCD56'
        ];

        let colorIndex = 0;
        const colors = [];

        for (const subj in subjectScores) {
            const scoresArr = subjectScores[subj];
            const avg = scoresArr.reduce((a, b) => a + b, 0) / scoresArr.length;
            labels.push(subj);
            avgScores.push(avg.toFixed(1));
            colors.push(colorPalette[colorIndex % colorPalette.length]);
            colorIndex++;

            if (avg < 60) weakSubjects.push(subj);
        }

        new Chart(document.getElementById('weakSubjectsChart'), {
            type: 'pie',
            data: {
                labels,
                datasets: [{
                    data: avgScores,
                    backgroundColor: colors
                }]
            },
            options: {
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context){
                                return `${context.label}: ${context.raw}%`;
                            }
                        }
                    }
                }
            }
        });

        // Display weak subjects below the chart
        const weakEl = document.getElementById('weakSubjectsList');
        if (weakSubjects.length > 0) {
            weakEl.textContent = "Weak Subjects: " + weakSubjects.join(', ');
            weakEl.style.color = "red";
        } else {
            weakEl.textContent = "No weak subjects! Keep it up!";
            weakEl.style.color = "green";
        }

    } catch (err) {
        console.error('Weak Subjects Chart Error:', err);
    }
})();


   </script>
</body>
</html>
